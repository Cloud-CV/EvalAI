<section class="ev-sm-container ev-view challenge-host-team-invitation">
    <div class="row">
      <div class="col-md-8 col-md-offset-2 ev-card-panel">
        <!-- Panel Title -->
        <div class="ev-md-container ev-panel-title">
          <h4>Team Invitation</h4>
        </div>
  
        <!-- Loading State: Display while fetching invitation details -->
        <div class="ev-md-container ev-card-body" ng-if="inviteAccept.isLoading">
          <div class="row">
            <div class="col s12 center-align">
              <div class="circular-loader">
                <div class="loader-path"></div>
              </div>
              <p>Loading invitation details...</p>
            </div>
          </div>
        </div>
  
        <!-- Error State: Display if an error occurred fetching or accepting -->
        <div class="ev-md-container ev-card-body" ng-if="!inviteAccept.isLoading && inviteAccept.error">
          <div class="row">
            <div class="col s12">
              <!-- General Error Message -->
              <div class="alert-error">
                <p><i class="fa fa-exclamation-triangle"></i> {{inviteAccept.error}}</p>
              </div>
  
              <!-- Specific Section for 'Wrong Account' (403 Error) -->
              <div class="center-align wrong-account-info" ng-if="inviteAccept.showLogoutOption">
                <!-- Simplified message as controller doesn't guarantee current user details are fetched -->
                <p>You are currently logged in, but this invitation was sent to a different email address:</p>
                <p><strong>{{inviteAccept.invitationDetails.email}}</strong></p>
                <p>Please log out and sign in with the correct account.</p>
                <button class="btn ev-btn-dark waves-effect waves-dark" ng-click="inviteAccept.logout()">
                  Logout and Switch Account
                </button>
              </div>
            </div>
          </div>
        </div>
  
        <!-- Invitation Details and Accept/Decline Actions: Display on success -->
        <div class="ev-md-container ev-card-body" ng-if="!inviteAccept.isLoading && !inviteAccept.error && inviteAccept.isLoggedIn">
          <!-- Check isLoggedIn here as well, because if the token expires between load and click,
               the controller might set error=null but isLoggedIn=false before redirecting -->
          <div class="row">
            <div class="col s12">
              <div class="invitation-details">
                <p class="fw-500">You have been invited to join a team on EvalAI.</p>
  
                <!-- Display Invitation Specifics -->
                <div class="team-info">
                  <p><span class="detail-label">Team:</span> <span class="detail-value">{{inviteAccept.invitationDetails.team.team_name}}</span></p>
                  <p><span class="detail-label">Invited by:</span> <span class="detail-value">{{inviteAccept.invitationDetails.invited_by.username}}</span></p>
                  <p><span class="detail-label">Invitation sent to:</span> <span class="detail-value">{{inviteAccept.invitationDetails.email}}</span></p>
                </div>
  
                <!-- Action Buttons -->
                <div class="center-align invitation-actions">
                  <!-- Accept Button -->
                  <button class="btn ev-btn-dark waves-effect waves-dark"
                          ng-click="inviteAccept.acceptInvitation()"
                          ng-disabled="inviteAccept.isAccepting">
                    <!-- Show spinner when accepting, check icon otherwise -->
                    <i class="fa" ng-class="{'fa-spinner fa-spin': inviteAccept.isAccepting, 'fa-check': !inviteAccept.isAccepting}"></i>
                    {{ inviteAccept.isAccepting ? 'Accepting...' : 'Accept Invitation' }}
                  </button>
  
                  <!-- Decline Button (navigates away) -->
                  <a ui-sref="home" class="btn ev-btn-light waves-effect waves-dark">
                    Decline
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
  
        <!-- Footer Information: Display only when showing invitation details -->
        <div class="ev-md-container ev-card-footer" ng-if="!inviteAccept.isLoading && !inviteAccept.error && inviteAccept.isLoggedIn">
          <div class="row">
            <div class="col s12">
              <p class="text-muted">
                <small>
                  <i class="fa fa-info-circle"></i>
                  By accepting this invitation, you'll become a member of this team and will be able to collaborate on challenges.
                </small>
              </p>
            </div>
          </div>
        </div>
  
      </div>
    </div>
  </section>