[uwsgi]

; -----------------------
; Application
; -----------------------
chdir = /code
module = evalai.wsgi:application
need-app = true

; -----------------------
; Master / lifecycle
; -----------------------
master = true
die-on-term = true
vacuum = true
single-interpreter = true

; -----------------------
; Networking (ALB -> container over HTTP)
; -----------------------
http-socket = 0.0.0.0:8000
http-keepalive = 1
so-keepalive = true
buffer-size = 32768
listen = 256

; -----------------------
; Concurrency (low-memory production)
; -----------------------
processes = 2
threads = 2
enable-threads = true
thunder-lock = true

; -----------------------
; Autoscale within uWSGI (keeps RAM low when idle)
; -----------------------
cheaper = 1
cheaper-initial = 1
cheaper-step = 1
cheaper-overload = 10
cheaper-algo = spare

; -----------------------
; Timeouts / stuck request protection
; -----------------------
harakiri = 60
harakiri-verbose = true
socket-timeout = 30
http-timeout = 30

; -----------------------
; Memory / leak protection
; -----------------------
max-requests = 1500
max-requests-delta = 300
reload-on-rss = 700
worker-reload-mercy = 60

; -----------------------
; Logging (keep useful errors, avoid noisy logs)
; -----------------------
disable-logging = false
log-4xx = true
log-5xx = true
log-slow = 2000

; -----------------------
; Production safety (do NOT use autoreload in prod)
; -----------------------
python-autoreload = 0

