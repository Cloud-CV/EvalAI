FROM python:2.7

ARG AWS_STORAGE_BUCKET_NAME
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_SQS_ENDPOINT
ARG AWS_SQS_QUEUE_NAME
ARG AWS_DEFAULT_REGION
ARG AWS_SES_REGION_NAME
ARG AWS_SES_REGION_ENDPOINT
ARG DATADOG_APP_NAME
ARG DATADOG_APP_KEY
ARG DATADOG_API_KEY
ARG EMAIL_HOST_PASSWORD
ARG EMAIL_HOST_USER
ARG EMAIL_HOST
ARG EMAIL_PORT
ARG EMAIL_USE_TLS
ARG RDS_DB_NAME
ARG RDS_HOSTNAME
ARG RDS_USERNAME
ARG RDS_PASSWORD
ARG SECRET_KEY
ARG SENTRY_URL

RUN echo "EMAIL_USE_TLS : $EMAIL_USE_TLS"

ENV PYTHONUNBUFFERED 1
ENV AWS_STORAGE_BUCKET_NAME=${AWS_STORAGE_BUCKET_NAME_STAGING}
ENV AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID_STAGING}
ENV AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY_STAGING}
ENV AWS_SQS_ENDPOINT=${AWS_SQS_ENDPOINT_STAGING}
ENV AWS_SQS_QUEUE_NAME=${AWS_SQS_QUEUE_NAME_STAGING}
ENV AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION_STAGING}
ENV AWS_SES_REGION_NAME=${AWS_SES_REGION_NAME_STAGING}
ENV AWS_SES_REGION_ENDPOINT=${AWS_SES_REGION_ENDPOINT_STAGING}
ENV DEBUG False
ENV DATADOG_APP_NAME=${DATADOG_APP_NAME_STAGING}
ENV DATADOG_APP_KEY=${DATADOG_APP_KEY_STAGING}
ENV DATADOG_API_KEY=${DATADOG_API_KEY_STAGING}
ENV DJANGO_SETTINGS_MODULE=settings.prod
ENV DJANGO_SERVER django
ENV EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD_STAGING}
ENV EMAIL_HOST_USER=${EMAIL_HOST_USER_STAGING}
ENV EMAIL_HOST=${EMAIL_HOST_STAGING}
ENV EMAIL_PORT=${EMAIL_PORT_STAGING}
ENV EMAIL_USE_TLS=${EMAIL_USE_TLS_STAGING}
ENV MEMCACHED_LOCATION None
ENV RDS_DB_NAME=${RDS_DB_NAME_STAGING}
ENV RDS_HOSTNAME=${RDS_HOSTNAME_STAGING}
ENV RDS_USERNAME=${RDS_USERNAME_STAGING}
ENV RDS_PASSWORD=${RDS_PASSWORD_STAGING}
ENV SECRET_KEY=${SECRET_KEY_STAGING}
ENV SENTRY_URL=${SENTRY_URL_STAGING}

RUN mkdir /code
WORKDIR /code
ADD requirements/* /code/
RUN pip install -r prod.txt

ADD . /code

EXPOSE 8000

CMD ["sh", "/code/docker/prod/django/container-start.sh"]
